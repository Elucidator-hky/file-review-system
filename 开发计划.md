# 文件审查系统 - 开发计划

## 项目概述
基于需求文档和技术文档，按模块逐步开发文件审查系统。

**重要说明**：
- ✅ **每个小节独立执行**：完成一个小节后，用户测试验证无误再继续下一个
- ✅ **严格顺序开发**：后续模块依赖前面的基础，必须按顺序进行
- ✅ **及时反馈**：每个小节执行完立即反馈问题，避免后期返工

---

## ⏱️ 时间评估

### 总体时间：预计 **2-3天**（按8小时/天计算）

| 阶段 | 预计时间 | 说明 |
|------|---------|------|
| 第一阶段：环境与基础架构 | 2-3小时 | 一次性配置，后续无需修改 |
| 第二阶段：用户认证与授权 | 3-4小时 | 核心基础，需要仔细测试 |
| 第三阶段：租户与用户管理 | 2-3小时 | 标准CRUD，相对简单 |
| 第四阶段：文件上传与存储 | 4-5小时 | MD5去重、秒传较复杂 |
| 第五阶段：审查任务管理 | 5-6小时 | 核心业务逻辑，最复杂 |
| 第六阶段：RabbitMQ与优化 | 2-3小时 | 基于前面的基础 |
| 第七阶段：测试与部署 | 2-3小时 | 集成测试、修复问题 |
| **总计** | **20-27小时** | **约2.5-3.5个工作日** |

**影响时间的因素**：
- ✅ 如果环境问题少（Docker顺利启动），可以节省1-2小时
- ✅ 如果测试发现的bug少，可以节省2-3小时
- ❌ 如果需求有变更或理解偏差，可能增加3-5小时
- ❌ 如果网络问题（Maven/NPM依赖下载慢），可能增加1-2小时

**建议安排**：
- 第1天：第一、二阶段（搭环境、登录认证）
- 第2天：第三、四阶段（用户管理、文件上传）
- 第3天：第五、六、七阶段（任务管理、优化、测试）

---

## 📋 开发阶段划分

### 第一阶段：环境与基础架构 ⬜
**目标**：搭建开发环境，创建项目骨架
**预计时间**：2-3小时

#### 1.1 Docker环境配置 ⬜
**执行时间**：30分钟
**输出文件**：
- `docker-compose.yml` - Docker服务编排配置
- `.env` - 环境变量配置
- `README-Docker.md` - Docker使用说明

**任务清单**：
- [ ] 创建 `docker-compose.yml`（MySQL、Redis、MinIO、RabbitMQ）
- [ ] 创建 `.env` 文件（密码、端口等配置）
- [ ] 创建Docker使用文档

**测试标准**：
```bash
docker-compose up -d
# 预期：所有服务启动成功（mysql、redis、minio、rabbitmq）
docker-compose ps
# 预期：4个服务全部显示 healthy 或 running
```

**可能的问题**：
- 端口冲突（3306、6379已被占用）→ 修改.env中的端口
- 网络问题（镜像下载慢）→ 配置Docker镜像加速

---

#### 1.2 数据库初始化 ⬜
**执行时间**：45分钟
**输出文件**：
- `sql/schema.sql` - 完整的数据库表结构（5张表）
- `sql/init-data.sql` - 初始化测试数据

**任务清单**：
- [ ] 创建所有数据库表（tenant、user、review_task、review_version、review_file）
- [ ] 创建索引和外键约束
- [ ] 插入初始数据（超管账号、测试租户、测试用户）

**测试标准**：
```bash
# 连接数据库
docker exec -it fileManageSystem-mysql mysql -uroot -proot123456

# 执行SQL脚本
source /docker-entrypoint-initdb.d/schema.sql
source /docker-entrypoint-initdb.d/init-data.sql

# 检查表
SHOW TABLES;  # 预期：5张表
SELECT * FROM user;  # 预期：至少有1个超管用户
```

**补充内容**：
- [ ] 添加数据库ER图说明
- [ ] 添加字段注释（方便后续维护）
- [ ] 创建视图（可选，用于复杂查询）

---

#### 1.3 后端项目骨架 ⬜
**执行时间**：60分钟
**输出文件**：
- `backend/pom.xml` - Maven依赖配置
- `backend/src/main/resources/application.yml` - Spring Boot配置
- `backend/src/main/java/com/review/ReviewApplication.java` - 启动类
- 完整的包结构（controller、service、mapper、entity等）

**任务清单**：
- [ ] 创建Maven项目结构
- [ ] 配置pom.xml（Spring Boot、MyBatis-Plus、Redis、MinIO、JWT等）
- [ ] 配置application.yml（数据库、Redis、MinIO连接信息）
- [ ] 创建统一响应类：Result.java
- [ ] 创建全局异常处理：GlobalExceptionHandler.java
- [ ] 创建健康检查接口：`GET /api/health`

**测试标准**：
```bash
cd backend
mvn clean install  # 预期：BUILD SUCCESS
mvn spring-boot:run  # 预期：启动成功，无报错

# 访问健康检查接口
curl http://localhost:8080/api/health
# 预期：{"code":"SUCCESS","message":"系统运行正常"}
```

**补充内容**：
- [ ] MyBatis-Plus配置（分页插件、租户拦截器）
- [ ] Swagger/Knife4j配置（API文档自动生成）
- [ ] 日志配置（logback.xml）
- [ ] 跨域配置（CorsConfig.java）

---

#### 1.4 前端项目骨架 ⬜
**执行时间**：45分钟
**输出文件**：
- `frontend/package.json` - NPM依赖配置
- `frontend/vite.config.js` - Vite构建配置
- `frontend/src/router/index.js` - 路由基础配置
- `frontend/src/utils/request.js` - Axios封装（拦截器）
- `frontend/src/App.vue` - 根组件

**任务清单**：
- [ ] 使用Vite创建Vue3项目
- [ ] 安装依赖（Vue Router、Pinia、Element Plus、Axios、SparkMD5）
- [ ] 配置Axios拦截器（自动携带Token、统一错误处理）
- [ ] 配置代理（开发环境跨域问题）
- [ ] 创建基础布局组件

**测试标准**：
```bash
cd frontend
npm install  # 预期：依赖安装成功
npm run dev  # 预期：启动成功，访问 http://localhost:5173

# 浏览器访问
http://localhost:5173
# 预期：显示欢迎页面或空白页（无报错）
```

**补充内容**：
- [ ] Element Plus按需导入配置
- [ ] 环境变量配置（.env.development、.env.production）
- [ ] CSS预处理器配置（Sass/Less）
- [ ] 全局样式（reset.css、common.css）

---

### 第二阶段：用户认证与授权 ⬜
**目标**：实现登录、权限控制、角色管理
**预计时间**：3-4小时

#### 2.1 后端认证模块 ⬜
**执行时间**：90分钟
**输出文件**：
- `entity/User.java` - 用户实体类
- `util/JwtUtil.java` - JWT工具类
- `filter/JwtFilter.java` - JWT过滤器
- `config/SecurityConfig.java` - Spring Security配置
- `controller/AuthController.java` - 登录接口
- `service/AuthService.java` - 认证服务

**任务清单**：
- [ ] 创建User实体类（映射user表）
- [ ] 实现JWT生成和验证逻辑
- [ ] 配置Spring Security（禁用默认登录页、配置白名单）
- [ ] 实现登录接口：`POST /api/auth/login`
- [ ] 实现修改密码接口：`POST /api/auth/change-password`
- [ ] 实现获取当前用户信息接口：`GET /api/auth/current-user`

**测试标准（Postman）**：
```json
// 1. 登录测试
POST http://localhost:8080/api/auth/login
{
  "username": "admin",
  "password": "123456"
}
// 预期：返回token和用户信息

// 2. 获取当前用户信息
GET http://localhost:8080/api/auth/current-user
Header: Authorization: Bearer {token}
// 预期：返回用户详细信息

// 3. 错误密码测试
POST http://localhost:8080/api/auth/login
{
  "username": "admin",
  "password": "wrong"
}
// 预期：返回"用户名或密码错误"
```

**补充内容**：
- [ ] 登录失败次数限制（Redis存储，5次锁定30分钟）
- [ ] 密码加密（BCrypt）
- [ ] 刷新Token机制（可选）
- [ ] 退出登录接口（清除Token）

---

#### 2.2 前端登录页面 ⬜
**执行时间**：60分钟
**输出文件**：
- `views/Login.vue` - 登录页面
- `api/auth.js` - 认证相关API封装
- `stores/auth.js` - 认证状态管理（Pinia）

**任务清单**：
- [ ] 创建登录页面（表单：用户名、密码）
- [ ] 封装登录API
- [ ] 创建Pinia Store（存储token、userInfo、roles）
- [ ] 实现登录成功后跳转逻辑

**测试标准**：
1. 访问 `http://localhost:5173/login`
2. 输入用户名：admin，密码：123456
3. 点击登录
4. 预期：登录成功，跳转到首页，localStorage中有token

**补充内容**：
- [ ] 记住密码功能（可选）
- [ ] 登录页面美化（背景图、动画效果）
- [ ] 错误提示优化（Element Plus Message）
- [ ] 登录加载状态（防止重复点击）

---

#### 2.3 前端路由守卫 ⬜
**执行时间**：45分钟
**输出文件**：
- `router/index.js` - 完整的路由配置（包含权限控制）
- 基础布局组件（PlatformLayout、AdminLayout、ReviewerLayout、UserLayout）

**任务清单**：
- [ ] 配置所有路由（平台超管、企业管理员、审查员、普通用户）
- [ ] 实现路由守卫（beforeEach）
- [ ] 创建4种布局组件（对应4种角色）
- [ ] 实现权限验证逻辑

**测试标准**：
1. 未登录访问 `/admin/users` → 重定向到 `/login`
2. 普通用户访问 `/admin/users` → 重定向到 `/user/my-tasks`
3. 审查员访问 `/reviewer/tasks` → 正常访问

**补充内容**：
- [ ] 404页面（路由不存在时显示）
- [ ] 403页面（无权限时显示）
- [ ] 动态面包屑导航
- [ ] 左侧菜单高亮（根据当前路由）

---

#### 2.4 角色动态切换 ⬜
**执行时间**：45分钟
**输出文件**：
- `components/layout/TopBar.vue` - 顶部导航栏（包含角色切换）
- `stores/auth.js` - 补充角色切换逻辑

**任务清单**：
- [ ] 创建TopBar组件（用户信息、角色切换下拉框）
- [ ] 实现角色切换逻辑（switchRole方法）
- [ ] 实现角色判断逻辑（isDualRole计算属性）
- [ ] 切换后自动跳转到对应角色首页

**测试标准**：
1. 使用双角色用户登录（审查员+普通用户）
2. 顶部显示"当前角色：审查员"，可以切换
3. 点击切换到"普通用户" → 页面切换到 `/user/my-tasks`，不刷新页面
4. 刷新浏览器 → 保持当前角色状态

**补充内容**：
- [ ] 切换角色时的过渡动画
- [ ] 修改密码对话框
- [ ] 退出登录确认框
- [ ] 用户头像显示（首字母或默认头像）

---

### 第三阶段：租户与用户管理 ⬜
**目标**：平台超管管理租户，企业管理员管理用户
**预计时间**：2-3小时

#### 3.1 租户管理（平台超管） ⬜
**执行时间**：90分钟
**输出文件**：
- `controller/TenantController.java` - 租户管理接口
- `service/TenantService.java` - 租户管理服务
- `mapper/TenantMapper.java` - 租户Mapper
- `views/platform/TenantManagement.vue` - 租户管理页面

**任务清单（后端）**：
- [ ] 创建Tenant实体类
- [ ] 实现租户CRUD接口
  - `POST /api/tenant` - 创建租户
  - `GET /api/tenant/list` - 分页查询租户
  - `GET /api/tenant/{id}` - 查询租户详情
  - `PUT /api/tenant/{id}` - 更新租户
  - `PUT /api/tenant/{id}/status` - 停用/启用
  - `DELETE /api/tenant/{id}` - 删除租户
- [ ] 添加参数校验（企业名称唯一性等）

**任务清单（前端）**：
- [ ] 创建租户管理页面
  - 租户列表表格（企业名称、联系人、配额、状态等）
  - 搜索筛选功能
  - 创建/编辑租户对话框
  - 停用/启用确认框
- [ ] API封装：`api/tenant.js`

**测试标准**：
1. 创建租户：企业名"测试企业"，配额100GB/50用户 → 成功
2. 查询列表：显示所有租户，分页正常
3. 编辑租户：修改配额为200GB → 成功
4. 停用租户：状态变为"停用" → 该租户下用户无法登录

**补充内容**：
- [ ] 导出租户列表（Excel）
- [ ] 租户存储使用量统计（进度条显示）
- [ ] 租户管理员列表查看

---

#### 3.2 用户管理（企业管理员） ⬜
**执行时间**：90分钟
**输出文件**：
- `controller/UserController.java` - 用户管理接口
- `service/UserService.java` - 用户管理服务
- `mapper/UserMapper.java` - 用户Mapper
- `views/admin/UserManagement.vue` - 用户管理页面

**任务清单（后端）**：
- [ ] 实现用户CRUD接口
  - `POST /api/user` - 创建用户
  - `GET /api/user/list` - 分页查询用户
  - `GET /api/user/{id}` - 查询用户详情
  - `PUT /api/user/{id}` - 更新用户
  - `PUT /api/user/{id}/status` - 停用/启用
  - `DELETE /api/user/{id}` - 删除用户
- [ ] 租户隔离（自动过滤当前租户的用户）
- [ ] 角色分配逻辑（可多选审查员+普通用户）

**任务清单（前端）**：
- [ ] 创建用户管理页面
  - 用户列表表格（用户名、真实姓名、角色、状态等）
  - 角色筛选（全部/企业管理员/审查员/普通用户）
  - 创建/编辑用户对话框（角色多选）
- [ ] API封装：`api/user.js`

**测试标准**：
1. 创建用户：用户名"zhangsan"，角色"审查员+普通用户" → 成功
2. 查询列表：按角色筛选，仅显示审查员
3. 编辑用户：修改角色为"普通用户" → 成功
4. 停用用户：该用户无法登录

**补充内容**：
- [ ] 批量导入用户（Excel模板）
- [ ] 重置密码功能
- [ ] 查看用户操作日志（可选）
- [ ] 审查员工作量统计

---

### 第四阶段：文件上传与存储 ⬜
**目标**：实现MD5去重、秒传、MinIO存储
**预计时间**：4-5小时

#### 4.1 MinIO配置 ⬜
**执行时间**：45分钟
**输出文件**：
- `config/MinioConfig.java` - MinIO配置类
- `util/MinioUtil.java` - MinIO工具类

**任务清单**：
- [ ] 配置MinIO连接（application.yml）
- [ ] 创建MinIO工具类
  - uploadFile() - 上传文件
  - downloadFile() - 下载文件
  - getPresignedUrl() - 生成预签名URL
  - deleteFile() - 删除文件（逻辑删除）
- [ ] 创建Bucket初始化逻辑

**测试标准**：
```java
// 单元测试
@Test
public void testUpload() {
    File file = new File("test.pdf");
    String objectName = minioUtil.uploadFile(file, "test-bucket", "test.pdf");
    assertNotNull(objectName);
}
```

**补充内容**：
- [ ] MinIO异常处理
- [ ] 自动创建Bucket（如果不存在）
- [ ] 文件元数据管理（content-type等）

---

#### 4.2 Web Worker MD5计算 ⬜
**执行时间**：60分钟
**输出文件**：
- `public/workers/md5Worker.js` - Web Worker脚本
- `utils/md5.js` - MD5计算工具

**任务清单**：
- [ ] 创建Web Worker（分片计算MD5）
- [ ] 封装MD5计算函数（返回Promise）
- [ ] 实现进度回调（每计算一片更新进度）

**测试标准**：
1. 上传200MB PDF文件
2. 控制台显示"计算文件指纹：10%...50%...100%"
3. 计算过程中可以操作其他UI（不卡顿）
4. 最终返回32位MD5值

**补充内容**：
- [ ] 错误处理（文件读取失败）
- [ ] 取消计算功能（中途取消上传）
- [ ] 支持多文件并发计算

---

#### 4.3 文件上传接口 ⬜
**执行时间**：90分钟
**输出文件**：
- `controller/FileController.java` - 文件管理接口
- `service/FileService.java` - 文件管理服务
- `mapper/ReviewFileMapper.java` - 文件Mapper
- `entity/ReviewFile.java` - 文件实体类

**任务清单**：
- [ ] 创建ReviewFile实体类
- [ ] 实现文件上传接口
  - `GET /api/file/check-exists?md5=xxx` - 检查MD5是否存在
  - `POST /api/file/upload` - 上传文件
  - `GET /api/file/list/{versionId}` - 查询版本文件列表
  - `GET /api/file/download/{fileId}` - 下载文件
  - `GET /api/file/preview/{fileId}` - 获取预览URL
  - `DELETE /api/file/{fileId}` - 删除文件
- [ ] 实现MD5去重逻辑
- [ ] 实现存储配额检查

**测试标准（Postman）**：
```json
// 1. 检查文件是否存在
GET /api/file/check-exists?md5=abc123...
预期：{"exists": false}

// 2. 上传文件
POST /api/file/upload
form-data:
  file: test.pdf
  md5: abc123...
  fileName: test.pdf
  versionId: 1
预期：{"isNewUpload": true, "fileId": 1}

// 3. 再次检查
GET /api/file/check-exists?md5=abc123...
预期：{"exists": true, "minioObjectName": "1001/abc123..."}

// 4. 上传相同文件
POST /api/file/upload（相同md5）
预期：{"isNewUpload": false, "fileId": 2}  // 秒传成功
```

**补充内容**：
- [ ] 文件类型校验（只允许PDF）
- [ ] 文件大小校验（最大200MB）
- [ ] 同版本文件名唯一性校验
- [ ] 并发上传处理（锁机制）

---

#### 4.4 文件上传组件 ⬜
**执行时间**：90分钟
**输出文件**：
- `components/FileUpload.vue` - 文件上传组件
- `api/file.js` - 文件相关API封装

**任务清单**：
- [ ] 创建文件上传组件
  - 文件选择（仅PDF）
  - MD5计算进度显示
  - 上传进度显示
  - 文件列表（已上传、待上传）
  - 删除文件功能
- [ ] 实现完整上传流程
  1. 选择文件
  2. 计算MD5（显示进度）
  3. 检查是否存在
  4. 上传/秒传（显示状态）
  5. 更新文件列表

**测试标准**：
1. 选择PDF文件 → 自动计算MD5，显示进度
2. 首次上传 → 显示"上传中"，进度条
3. 上传同一文件 → 显示"秒传成功"
4. 上传非PDF文件 → 提示"仅支持PDF格式"
5. 上传超大文件（>200MB） → 提示"文件大小超限"

**补充内容**：
- [ ] 拖拽上传功能
- [ ] 批量上传（选择多个文件）
- [ ] 上传失败重试
- [ ] 上传记录缓存（刷新页面不丢失）

---

### 第五阶段：审查任务管理 ⬜
**目标**：创建任务、提交版本、执行审查
**预计时间**：5-6小时

#### 5.1 创建审查任务（普通用户） ⬜
**执行时间**：90分钟
**输出文件**：
- `controller/TaskController.java` - 任务管理接口
- `service/TaskService.java` - 任务管理服务
- `mapper/ReviewTaskMapper.java` - 任务Mapper
- `mapper/ReviewVersionMapper.java` - 版本Mapper
- `entity/ReviewTask.java` - 任务实体类
- `entity/ReviewVersion.java` - 版本实体类
- `views/user/CreateTask.vue` - 创建任务页面

**任务清单（后端）**：
- [ ] 创建ReviewTask、ReviewVersion实体类
- [ ] 实现创建任务接口：`POST /api/task`
  - 创建任务记录
  - 创建版本v1记录
  - 关联文件到版本
  - 事务控制（原子性）
- [ ] 参数校验（任务名唯一、审查员有效等）

**任务清单（前端）**：
- [ ] 创建任务页面
  - 表单：任务名、审查员选择、提交说明
  - 文件上传组件集成
  - 提交按钮
- [ ] API封装：`api/task.js`

**测试标准**：
1. 填写任务名"项目评审"，选择审查员，上传3个PDF文件
2. 点击提交 → 任务创建成功
3. 数据库检查：
   - review_task表：有1条记录，status=REVIEWING
   - review_version表：有1条记录，version_number=1
   - review_file表：有3条记录，关联到版本v1

**补充内容**：
- [ ] 草稿保存功能（自动保存）
- [ ] 审查员搜索功能
- [ ] 文件预览功能（创建前预览）
- [ ] 任务模板功能（快速创建相似任务）

---

#### 5.2 查询任务列表 ⬜
**执行时间**：90分钟
**输出文件**：
- `controller/TaskController.java` - 补充查询接口
- `views/user/MyTasks.vue` - 我的任务列表（普通用户）
- `views/reviewer/TaskList.vue` - 待审查任务列表（审查员）

**任务清单（后端）**：
- [ ] 实现查询接口
  - `GET /api/task/my-tasks` - 我的任务（创建者）
  - `GET /api/task/review-tasks` - 待审查任务（审查员）
  - `GET /api/task/{id}` - 任务详情
  - `GET /api/version/{id}` - 版本详情
- [ ] 支持分页、筛选、排序

**任务清单（前端）**：
- [ ] 我的任务页面（普通用户）
  - 任务列表（可展开查看版本记录）
  - 状态筛选（全部/审查中/已通过/已打回）
  - 操作按钮（提交新版本、查看详情）
- [ ] 待审查任务页面（审查员）
  - 任务列表（可展开查看版本记录）
  - 操作按钮（开始审查）

**测试标准**：
1. 普通用户查看"我的任务" → 显示自己创建的任务
2. 点击任务行 → 展开显示版本记录（v1、v2...）
3. 审查员查看"待审查任务" → 显示分配给自己的任务
4. 筛选"已通过"状态 → 仅显示已通过的任务

**补充内容**：
- [ ] 任务搜索功能（按任务名搜索）
- [ ] 批量操作（批量删除草稿）
- [ ] 导出任务列表（Excel）
- [ ] 任务统计（总数、各状态数量）

---

#### 5.3 执行审查（审查员） ⬜
**执行时间**：120分钟
**输出文件**：
- `controller/VersionController.java` - 版本管理接口
- `service/VersionService.java` - 版本管理服务
- `views/reviewer/ReviewDetail.vue` - 审查详情页面

**任务清单（后端）**：
- [ ] 实现审查接口：`POST /api/version/{id}/review`
  - 验证权限（是否是任务审查员）
  - 验证状态（是否可审查）
  - 更新版本状态（APPROVED/REJECTED）
  - 更新任务状态
  - 记录审查意见、审查时间

**任务清单（前端）**：
- [ ] 审查详情页面
  - 任务信息展示（任务名、提交人、版本号）
  - 提交说明展示
  - 文件列表（文件名、大小、预览、下载）
  - PDF预览（使用PDF.js）
  - 审查表单（单选：通过/打回，意见：文本框）
  - 提交按钮
- [ ] 集成PDF.js库

**测试标准**：
1. 审查员点击"开始审查" → 跳转到审查详情页
2. 查看文件列表 → 点击预览 → PDF正常显示
3. 选择"打回"，填写意见"格式不符合要求" → 提交成功
4. 任务状态变为"已打回"，普通用户可以提交新版本

**补充内容**：
- [ ] PDF批注功能（可选，较复杂）
- [ ] 审查模板（常用审查意见快速选择）
- [ ] 审查历史记录（查看所有版本的审查意见）
- [ ] 文件对比功能（对比两个版本的文件差异）

---

#### 5.4 提交新版本（普通用户） ⬜
**执行时间**：120分钟
**输出文件**：
- `controller/TaskController.java` - 补充提交新版本接口
- `service/FileCopyService.java` - 文件复制服务（RabbitMQ发送消息）
- `consumer/FileCopyConsumer.java` - 文件复制消费者
- `views/user/SubmitNewVersion.vue` - 提交新版本页面

**任务清单（后端）**：
- [ ] 实现提交新版本接口：`POST /api/task/{id}/new-version`
  - 验证权限（是否是创建者）
  - 验证状态（是否是REJECTED）
  - 创建新版本记录（version_number+1，files_ready=0）
  - 发送RabbitMQ消息（异步复制文件）
  - 立即返回（不等待复制完成）
- [ ] 实现RabbitMQ消费者
  - 查询上一版本的文件
  - 批量复制文件记录（复用minio_object_name）
  - 更新版本状态（files_ready=1）
- [ ] 实现查询版本状态接口：`GET /api/version/{id}/status`

**任务清单（前端）**：
- [ ] 提交新版本页面
  - 提交说明表单
  - 提交按钮
  - 等待文件复制提示（轮询状态）
  - 复制完成后显示文件列表
  - 文件管理（删除、上传新文件）
- [ ] 实现轮询逻辑（每2秒查询一次，最多30次）

**测试标准**：
1. 任务被打回后，点击"提交新版本"
2. 填写提交说明 → 提交
3. 显示"正在复制文件..." → 轮询状态
4. 2秒后文件复制完成 → 显示文件列表
5. 删除1个文件，上传1个新文件 → 最终提交
6. 数据库检查：
   - review_version表：有v2记录，files_ready=1
   - review_file表：v2关联的文件正确

**补充内容**：
- [ ] 复制超时处理（60秒未完成提示刷新）
- [ ] 取消提交功能（复制过程中取消）
- [ ] 版本对比功能（查看v1和v2的文件差异）

---

### 第六阶段：RabbitMQ与性能优化 ⬜
**目标**：异步处理、Redis缓存
**预计时间**：2-3小时

#### 6.1 RabbitMQ配置 ⬜
**执行时间**：60分钟
**输出文件**：
- `config/RabbitMQConfig.java` - RabbitMQ配置类
- `dto/FileCopyMessage.java` - 文件复制消息实体
- `consumer/FileCopyConsumer.java` - 消费者（5.4已创建）

**任务清单**：
- [ ] 配置RabbitMQ连接（application.yml）
- [ ] 创建队列、交换机、绑定
  - 队列：file.copy.queue
  - 交换机：file.copy.exchange（Direct）
  - 路由键：file.copy.routing.key
- [ ] 创建消息实体：FileCopyMessage
- [ ] 配置消费者并发数（3-5）
- [ ] 配置死信队列（处理失败的消息）

**测试标准**：
1. 提交新版本 → RabbitMQ管理界面看到消息入队
2. 消费者自动消费 → 文件复制成功
3. 手动停止消费者 → 消息堆积在队列
4. 重启消费者 → 消息被消费

**补充内容**：
- [ ] 消息持久化（防止RabbitMQ重启丢失）
- [ ] 消费失败重试机制（最多3次）
- [ ] 监控消息堆积（报警）

---

#### 6.2 Redis缓存 ⬜
**执行时间**：90分钟
**输出文件**：
- `config/RedisConfig.java` - Redis配置类
- `util/RedisUtil.java` - Redis工具类
- `service/StatisticsService.java` - 统计服务（使用缓存）

**任务清单**：
- [ ] 配置Redis连接（application.yml）
- [ ] 创建Redis工具类（set、get、increment、expire等）
- [ ] 实现缓存功能
  - 存储统计数据（租户存储使用量）
  - 登录失败次数限制
  - 热点数据缓存（审查员列表）
- [ ] 实现缓存更新策略（定时更新、主动失效）

**测试标准**：
1. 上传文件 → Redis中租户存储使用量自动更新
2. 查询平台统计 → 第一次查数据库，第二次走缓存（速度明显提升）
3. 登录失败5次 → Redis记录失败次数，锁定用户30分钟
4. 30分钟后 → 自动解锁

**补充内容**：
- [ ] 缓存穿透防护（布隆过滤器）
- [ ] 缓存雪崩防护（随机过期时间）
- [ ] 缓存预热（系统启动时加载常用数据）
- [ ] Redis监控（内存使用、命中率）

---

### 第七阶段：测试与部署 ⬜
**目标**：集成测试、生产环境部署
**预计时间**：2-3小时

#### 7.1 功能测试 ⬜
**执行时间**：90分钟
**输出文件**：
- `测试报告.md` - 测试用例和结果

**任务清单**：
- [ ] 完整业务流程测试
  1. 平台超管创建租户
  2. 企业管理员创建用户（审查员、普通用户）
  3. 普通用户创建任务并上传文件（测试秒传）
  4. 审查员执行审查（测试PDF预览）
  5. 普通用户提交新版本（测试异步复制）
  6. 审查员再次审查并通过
- [ ] 权限测试
  - 普通用户尝试访问租户管理 → 403
  - 审查员尝试审查别人的任务 → 403
  - 跨租户数据访问 → 403
- [ ] 性能测试
  - 并发上传（10个用户同时上传）
  - 大文件上传（200MB PDF）
  - 秒传速度（毫秒级）

**测试标准**：
- 所有功能正常运行，无阻塞性bug
- 权限控制严格，无越权访问
- 性能符合预期（上传速度、响应时间）

---

#### 7.2 Docker部署 ⬜
**执行时间**：90分钟
**输出文件**：
- `backend/Dockerfile` - 后端镜像构建文件
- `frontend/Dockerfile` - 前端镜像构建文件
- `docker-compose.prod.yml` - 生产环境编排文件
- `部署文档.md` - 部署说明

**任务清单**：
- [ ] 创建后端Dockerfile（多阶段构建）
- [ ] 创建前端Dockerfile（Nginx）
- [ ] 创建生产环境docker-compose.yml
  - 包含所有服务（MySQL、Redis、MinIO、RabbitMQ、后端、前端）
  - 配置数据卷挂载（持久化）
  - 配置网络（服务间通信）
- [ ] 编写部署文档

**测试标准**：
```bash
# 一键部署
docker-compose -f docker-compose.prod.yml up -d

# 访问前端
http://localhost  # 显示登录页

# 访问后端健康检查
http://localhost:8080/api/health  # 返回SUCCESS
```

**补充内容**：
- [ ] Nginx配置（反向代理、静态资源）
- [ ] 日志收集（ELK/Loki）
- [ ] 监控告警（Prometheus+Grafana）
- [ ] 自动备份脚本（数据库、MinIO）

---

## 🎯 当前进度

**阶段**：准备开始
**下一步**：执行 1.1 Docker环境配置
**预计完成时间**：30分钟

---

## 📝 开发约定

### 命名规范
- 数据库表：snake_case（如：review_task）
- Java类：PascalCase（如：ReviewTask）
- Java方法/变量：camelCase（如：createTask）
- 前端文件：PascalCase（如：TaskList.vue）
- 前端变量：camelCase（如：taskList）

### 测试标准
每个模块开发完成后，需要：
1. **后端**：Postman测试接口（我会提供测试用例）
2. **前端**：浏览器测试页面功能
3. **集成**：前后端联调测试
4. **反馈**：告知开发者测试结果（通过/失败/问题描述）

### 问题反馈格式
```
✅ 好的反馈：
"1.1 Docker配置执行成功，所有服务已启动"
"2.1 登录接口报错：NullPointerException at UserService.java:45"
"4.4 文件上传成功，但秒传功能没生效，还是重新上传了"

❌ 不好的反馈：
"有问题"
"不太对"
"好像启动不了"
```

---

## 📌 注意事项

1. **严格按顺序**：每个小节必须测试通过后再继续
2. **及时反馈**：发现问题立即反馈，避免后续返工
3. **保留日志**：遇到报错时，保留完整的错误信息
4. **环境一致**：确保Java、Node.js版本符合要求
5. **网络通畅**：Maven、NPM依赖下载可能较慢，需耐心等待

---

## 🚀 快速命令

### Docker相关
```bash
# 启动所有服务
docker-compose up -d

# 查看日志
docker-compose logs -f [服务名]

# 停止所有服务
docker-compose down

# 重启某个服务
docker-compose restart [服务名]

# 查看服务状态
docker-compose ps
```

### 后端相关
```bash
# 安装依赖
cd backend
mvn clean install

# 启动后端
mvn spring-boot:run

# 打包
mvn clean package -DskipTests
```

### 前端相关
```bash
# 安装依赖
cd frontend
npm install

# 启动开发服务器
npm run dev

# 打包生产
npm run build
```

---

**最后更新时间**：2025-11-28
**当前版本**：v0.2 - 优化版（详细任务清单+时间评估）
