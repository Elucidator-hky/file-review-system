# 文件审查管理平台 - 需求文档

## 1. 系统概述

### 1.1 项目名称

文件审查管理平台（File Review Management Platform）

### 1.2 项目背景

面向企业提供审查任务全流程管理，包括任务创建、文件上传、在线浏览、审查意见、版本管理、归档等功能。支持多租户SaaS模式，实现企业级数据隔离和权限管理。

### 1.3 业务价值

- 规范审查流程，提升审查效率
- 审查意见闭环管理，确保问题得到解决
- 审查版本控制，追溯历史变更
- 集中管理审查任务，避免流程混乱
- 数据统计分析，辅助管理决策

### 1.4 项目目标

- 实现审查任务的完整流程管理
- 提供在线浏览与审查意见能力
- 实现完整的审查闭环流程
- 保证系统高并发、高性能
- 实现SaaS多租户数据隔离

## 2. 系统角色

### 2.1 角色关系

系统包含4种角色，按权限和管理范围分为两个层级：

**平台层级：**
- **平台超级管理员**：管理整个平台，负责创建和管理企业租户，查看全平台数据

**租户层级（企业内部）：**
- **企业管理员**：管理本企业的用户和数据，负责创建用户、分配角色、查看企业统计
- **审查员**：处理分配给自己的审查任务，可以审查通过或打回
- **普通用户**：创建审查任务、上传文件、选择审查员、查看审查结果

**角色关系说明：**
- 平台超级管理员与企业租户相互独立，超管不能直接操作租户内的业务数据
- 企业管理员属于管理角色，是独立的角色，不能与审查员或普通用户角色并存
- 企业管理员可以创建其他企业管理员，也可以为普通用户分配多个业务角色
- 审查员和普通用户属于业务角色，一个用户可以同时拥有这两个角色（双角色用户）

**数据隔离：**
- 租户之间数据完全隔离（通过tenant_id区分）
- 企业管理员只能看到本企业的用户和数据
- 审查员只能看到分配给自己的审查任务
- 普通用户只能看到自己创建的审查任务

### 2.2 平台超级管理员

#### 2.2.1 职责

- 创建企业租户（分配存储配额、用户数量配额）
- 为租户创建首个企业管理员（占用用户配额）
- 调整租户配额（存储空间、用户数量）
- 启用/停用租户账号
- 查看全平台运营数据统计

#### 2.2.2 创建方式

通过数据库脚本预置，初始密码加密存储。如需新增超管，由已有超管通过SQL语句手动添加。

#### 2.2.3 操作界面

**主菜单**：
- 租户管理
- 平台统计

#### 2.2.4 租户管理

**企业列表页面布局**：
- 页面标题："租户管理"
- 工具栏：
  - 左侧："创建企业"按钮（主按钮）
  - 右侧：状态筛选下拉框、企业名称搜索框、"搜索"按钮
- 列表区域（表格形式）：
  - 表格列：
    - 企业名称
    - 联系人
    - 联系电话
    - 用户数（已用/总配额，如：25/50）
    - 存储空间（已用/总配额，如：50GB/100GB）
    - 状态（正常/停用，标签形式）
    - 创建时间
    - 操作列：查看详情、编辑配额、停用/启用、删除
- 底部分页器

**企业详情页面布局**：
- 页面标题："企业详情"
- 返回按钮
- 基本信息卡片：
  - 企业名称
  - 联系人、联系电话
  - 创建时间、当前状态
- 配额信息卡片：
  - 存储配额：已用/总配额（进度条显示）
  - 用户配额：已用/总配额
- 企业管理员列表：
  - 列表标题："企业管理员"
  - 右侧："添加管理员"按钮
  - 表格列：
    - 用户名
    - 真实姓名
    - 手机号
    - 创建时间
    - 最后登录时间
    - 操作列：编辑、删除
- 底部操作按钮：编辑配额、停用/启用企业、删除企业

**管理员管理对话框**：

添加/编辑管理员对话框：
- 对话框标题："添加管理员" 或 "编辑管理员"
- 表单字段：
  - 用户名（必填*，仅添加时可填写，企业内唯一）
  - 真实姓名（必填*）
  - 手机号（必填*，企业内唯一）
  - 初始密码（必填*，仅添加时显示，最少6位）
- 提示文字："添加管理员会占用企业用户配额"
- 按钮："取消"、"确定"

删除管理员确认框：
- 提示内容："删除后该管理员将无法登录系统，是否确认删除？"
- 按钮："取消"、"确认删除"

**创建企业页面布局**：
- 页面标题："创建企业"
- 表单字段：
  - 企业名称（必填*）
  - 联系人姓名（必填*）
  - 联系电话（必填*）
  - 存储配额（GB，默认100）
  - 用户数量配额（默认50）
  - 底部按钮："取消"、"提交"

> **说明**：创建企业仅保存企业/配额信息。创建成功后在“企业详情”的“企业管理员”模块里添加首个管理员（可随时新增/重置/启用停用），与租户创建完全独立。当管理员创建失败时，只需在管理员模块重试，不影响租户信息。

#### 2.2.5 平台统计

**平台统计页面布局**：
- 页面标题："平台统计"
- 统计卡片区域（并排显示）：
  - 租户总数（数字 + 趋势图标）
  - 用户总数（数字 + 趋势图标）
  - 审查任务总数（数字 + 趋势图标）
  - 存储使用量（数字 + 进度条）

### 2.3 企业管理员

#### 2.3.1 职责

- 创建本企业用户账号（企业管理员、审查员或普通用户）
- 查看和管理本企业所有用户
- 编辑用户信息（姓名、手机、部门、职位）
- 为用户分配角色（企业管理员、审查员或普通用户，可同时分配审查员和普通用户）
- 启用/禁用用户账号
- 删除用户账号
- 重置用户密码
- 查看本企业数据统计

#### 2.3.2 创建方式

- 首个企业管理员：由平台超管创建企业时指定
- 后续企业管理员：由现有企业管理员创建用户时指定角色为"企业管理员"

#### 2.3.3 操作界面

**主菜单**：
- 用户管理
- 企业信息
- 数据统计

#### 2.3.4 用户管理

**用户列表页面布局**：
- 页面标题："用户管理"
- 工具栏：
  - 左侧："创建用户"按钮（主按钮）
  - 右侧：角色筛选下拉框、状态筛选下拉框、搜索框（用户名/姓名/部门）、"搜索"按钮
- 列表区域（表格形式）：
  - 表格列：
    - 用户名
    - 真实姓名
    - 角色（可能多个，标签显示）
    - 部门
    - 职位
    - 手机号
    - 账号状态（启用/禁用，标签形式）
    - 创建时间
    - 最后登录时间
    - 操作列：查看详情、编辑、重置密码、禁用/启用、删除
- 底部分页器

**用户详情页面布局**：
- 页面标题："用户详情"
- 返回按钮
- 基本信息卡片：用户名、姓名、角色、部门、职位
- 联系信息卡片：手机号
- 状态信息卡片：账号状态、创建时间、最后登录时间
- 业务统计卡片：发起审查任务数、完成审查任务数
- 底部操作按钮：编辑、重置密码、禁用/启用、删除

**创建用户页面布局**：
- 页面标题："创建用户"
- 表单区域（居中）：
  - 用户名（必填*，提示：企业内唯一，3-20个字符）
  - 真实姓名（必填*）
  - 手机号（选填）
  - 部门（选填）
  - 职位（选填）
  - 角色（必选*）：
    - ○ 企业管理员（单选，独立角色）
    - ☐ 审查员（可多选，业务角色）
    - ☐ 普通用户（可多选，业务角色）
    - 说明："企业管理员"为独立角色，不可与其他角色同时选择；"审查员"和"普通用户"可同时选择
  - 初始密码（必填*）
- 底部按钮："取消"、"提交"

#### 2.3.5 企业信息

**企业信息页面布局**：
- 页面标题："企业信息"
- 基本信息卡片：
  - 企业名称
  - 联系人、联系电话
- 配额使用情况卡片：
  - 存储空间：已用/总配额（进度条显示）
  - 用户数量：已创建/总配额
  - 提示文字："配额调整需联系平台超管"

#### 2.3.6 数据统计

**数据统计页面布局**：
- 页面标题："数据统计"

- 用户统计卡片区域（并排显示）：
  - 用户总数（数字，按角色分类显示：企业管理员/审查员/普通用户）
  - 活跃用户数（数字 + 说明：本月有登录）

- 业务统计卡片区域（并排显示）：
  - 审查任务总数（数字）
  - 待处理任务数（数字）
  - 已完成任务数（数字）
  - 审查通过率（百分比 + 环形图）
  - 本月新增任务数（数字 + 趋势图）

- 用户工作量排行区域（左右分栏）：
  - 左侧：TOP10 发起审查任务最多的用户（排行榜列表）
  - 右侧：TOP10 完成审查任务最多的审查员（排行榜列表）

### 2.4 审查员

#### 2.4.1 职责

- 查看分配给自己的审查任务
- 查看任务的提交说明和文件
- 审查文件并决定通过或打回
- 打回时填写审查意见说明原因
- 查看历史审查版本

#### 2.4.2 操作界面

**主菜单**：
- 审查任务
- 工作统计

#### 2.4.3 任务管理

详见"第3章 审查流程 - 3.3 审查员任务列表"

#### 2.4.4 工作统计

**工作统计页面布局**：
- 页面标题："工作统计"
- 统计卡片区域（并排显示）：
  - 待处理任务数量（数字 + 图标）
  - 已完成任务数量（数字 + 图标）
  - 本月完成任务数（数字 + 图标）
- 趋势图区域：
  - 近30天任务完成趋势图（折线图或柱状图）

### 2.5 普通用户

#### 2.5.1 职责

- 创建审查任务
- 上传审查文件（可多个）
- 填写提交说明
- 选择审查员
- 查看审查结果
- 根据审查意见修改文件并再次提交

#### 2.5.2 操作界面

**主菜单**：
- 审查任务
- 个人统计

#### 2.5.3 任务管理

详见"第3章 审查流程 - 3.1 用户审查任务列表"

#### 2.5.4 个人统计

**个人统计页面布局**：
- 页面标题："个人统计"
- 统计卡片区域（并排显示）：
  - 发起的审查任务数量（数字 + 图标）
  - 审查通过率（百分比 + 环形图）
  - 本月审查任务数（数字 + 图标）
  - 存储使用量（数字 + 进度条）

### 2.6 用户账号规则

**用户名规则**：
- 企业内唯一
- 长度：3-20个字符
- 允许：字母、数字、下划线、中划线

**手机号规则**：
- 企业内唯一
- 格式：中国大陆手机号（11位）

**密码规则**：
- 长度：至少8位
- 复杂度：包含大小写字母、数字、特殊字符中的至少3种
- 加密：使用BCrypt加密存储

**登录安全**：
- 失败限制：连续失败5次锁定30分钟
- Token有效期：24小时

## 3. 审查流程

### 3.0 整体页面架构

系统包含4种页面架构：普通用户前台、审查员前台、企业管理员后台、平台超级管理员后台。根据登录用户的角色自动显示对应的页面架构。

#### 3.0.1 普通用户前台页面架构

**顶部导航栏**（固定在顶部）：
- 左侧：系统名称"文件审查管理平台"（纯文字）
- 右侧：用户信息区
  - 显示：用户名
  - 头像图标（可点击）
  - 点击头像弹出下拉菜单：
    - 切换角色（仅双角色用户显示：如果用户同时是审查员，显示"切换到审查员"）
    - 修改密码
    - 退出登录

**左侧菜单栏**（固定在左侧，宽度约200px）：
- 审查任务
- 个人统计

**右侧主内容区**（占据剩余空间）：
- 显示具体页面内容（任务列表、创建任务、任务详情等）

#### 3.0.2 审查员前台页面架构

**顶部导航栏**（固定在顶部）：
- 左侧：系统名称"文件审查管理平台"（纯文字）
- 右侧：用户信息区
  - 显示：用户名
  - 头像图标（可点击）
  - 点击头像弹出下拉菜单：
    - 切换角色（仅双角色用户显示：如果用户同时是普通用户，显示"切换到用户"）
    - 修改密码
    - 退出登录

**左侧菜单栏**（固定在左侧，宽度约200px）：
- 审查任务
- 工作统计

**右侧主内容区**（占据剩余空间）：
- 显示具体页面内容（待审查任务列表、审查页面、任务详情等）

#### 3.0.3 企业管理员后台页面架构

**顶部导航栏**（固定在顶部）：
- 左侧：系统名称"文件审查管理平台 - 企业管理后台"（纯文字）
- 右侧：用户信息区
  - 显示：用户名
  - 头像图标（可点击）
  - 点击头像弹出下拉菜单：
    - 修改密码
    - 退出登录

**左侧菜单栏**（固定在左侧，宽度约200px）：
- 用户管理
- 企业信息
- 数据统计

**右侧主内容区**（占据剩余空间）：
- 显示具体页面内容（用户列表、创建用户、企业信息、统计报表等）

#### 3.0.4 平台超级管理员后台页面架构

**顶部导航栏**（固定在顶部）：
- 左侧：系统名称"文件审查管理平台 - 平台管理后台"（纯文字）
- 右侧：用户信息区
  - 显示：用户名
  - 头像图标（可点击）
  - 点击头像弹出下拉菜单：
    - 修改密码
    - 退出登录

**左侧菜单栏**（固定在左侧，宽度约200px）：
- 租户管理
- 平台统计

**右侧主内容区**（占据剩余空间）：
- 显示具体页面内容（租户列表、创建租户、租户详情、平台统计等）

#### 3.0.5 角色切换说明

- **单角色用户**：登录后直接显示对应角色的页面架构，头像下拉菜单不显示"切换角色"选项
- **双角色用户**（同时是普通用户和审查员）：
  - 登录后默认显示普通用户前台
  - 点击头像下拉菜单，显示"切换到审查员"选项
  - 点击切换后，**动态切换页面架构**（不刷新页面）：
    - 左侧菜单切换为审查员菜单（审查任务、工作统计）
    - 右侧内容区切换到审查员首页（待审查任务列表）
    - 页面顶部标题保持为"文件审查管理平台"
    - 当前角色状态保存在浏览器本地存储（localStorage）
  - 在审查员前台时，头像下拉菜单显示"切换到用户"
  - 切换回用户角色时，页面架构动态切换为普通用户前台
- **企业管理员和平台超级管理员**：不能切换角色，只能访问对应的后台页面
- **技术实现**：使用Pinia状态管理保存当前角色，Vue Router动态路由实现页面切换

### 3.1 用户审查任务列表

用户登录后，如果角色是"普通用户"，在左侧菜单点击"审查任务"进入此页面。如果用户同时是普通用户和审查员，需先在头像下拉菜单切换到"用户"角色。

**页面布局**：

**页面顶部区域**：
- 页面标题："我的审查任务"（左上角）
- 工具栏：
  - 左侧："创建审查任务"按钮（主按钮，绿色或蓝色突出显示）
  - 右侧依次排列：
    - 状态筛选下拉框（选项：全部/审查中/已通过/已打回，默认"全部"）
    - 任务名称搜索框（带搜索图标）
    - "搜索"按钮

**列表区域**（表格形式）：
- 表格列：
  - 任务名称（可点击，链接到任务详情）
  - 审查员（显示姓名）
  - 文件数量（如：3个文件）
  - 创建时间（格式：YYYY-MM-DD HH:mm）
  - 当前版本（如：v1、v2、v3）
  - 任务状态（标签形式，不同颜色：审查中-黄色、已通过-绿色、已打回-红色）
  - 操作列（每行末尾）：
    - "查看详情"按钮（链接按钮）
    - "查看历史"按钮（仅当版本号>v1时显示）

**底部分页器**：
- 显示总数、当前页/总页数
- 上一页、下一页、跳转页码

---

**任务详情页面布局**：

点击"查看详情"或任务名称进入任务详情页面。

**页面顶部**：
- 返回按钮（左上角，"← 返回列表"）
- 页面标题："审查任务详情"

**详情展示区域**（卡片式布局）：
- **基本信息卡片**：
  - 任务名称（大标题）
  - 审查员：XXX
  - 当前版本：v1
  - 任务状态：审查中（标签，带颜色）
  - 创建时间：YYYY-MM-DD HH:mm

- **提交信息卡片**（如用户有填写）：
  - 标题："提交说明"
  - 内容：用户填写的文字（多行显示）

- **文件列表卡片**：
  - 标题："审查文件"
  - 文件列表（每个文件一行）：
    - 文件类型图标（PDF/图片）
    - 文件名
    - 文件大小
    - 操作按钮："预览"、"下载"

- **审查信息卡片**（如审查员有填写）：
  - 标题："审查意见"
  - 审查员：XXX
  - 审查时间：YYYY-MM-DD HH:mm
  - 内容：审查员填写的文字（多行显示）

**底部操作按钮**：
- 状态为"已打回"：显示"再次提交"按钮（主按钮，绿色或蓝色）
- 状态为"已通过"：无操作按钮
- 状态为"审查中"：无操作按钮

---

**历史版本页面布局**：

点击列表中的"查看历史"按钮进入历史版本页面。

**页面顶部**：
- 返回按钮（左上角，"← 返回列表"）
- 页面标题："历史版本 - [任务名称]"

**版本列表区域**（时间轴或卡片式）：
- 当前版本（置顶，带"当前"标签）：
  - 版本号：v3
  - 提交时间：YYYY-MM-DD HH:mm
  - 状态：审查中（或已通过/已打回）
  - 操作按钮："查看详情"

- 历史版本（按时间倒序）：
  - 版本号：v2
  - 提交时间：YYYY-MM-DD HH:mm
  - 状态：已打回
  - 操作按钮："查看详情"

  - 版本号：v1
  - 提交时间：YYYY-MM-DD HH:mm
  - 状态：已打回
  - 操作按钮："查看详情"

注：历史版本（v1、v2...）都是被打回的版本，通过的版本即为当前最新版本。

---

**历史版本详情页面布局**：

点击某个历史版本的"查看详情"按钮进入。

布局与"任务详情页面"相同，区别是：
- 页面标题："历史版本详情 - v1"
- 显示该版本的提交信息、文件列表、审查意见
- 文件只能预览和下载，不能修改
- 无操作按钮（历史版本只读）

### 3.2 用户提交审查

用户在审查任务列表页面点击"创建审查任务"按钮，进入创建审查任务页面。

**页面布局**：

**页面顶部**：
- 返回按钮（左上角，"← 返回列表"）
- 页面标题："创建审查任务"

**表单区域**（居中，最大宽度800px）：

**基本信息区域**：
- 任务名称：
  - 标签："任务名称 *"（红色星号表示必填）
  - 输入框：单行文本框（宽度100%）
  - 提示文字："请输入任务名称"

- 提交信息：
  - 标签："提交说明"（可选）
  - 输入框：多行文本框（高度约100px，宽度100%）
  - 提示文字："可说明文件内容、审查要点等"

- 选择审查员：
  - 标签："审查员 *"（红色星号表示必填）
  - 下拉选择框：单选，显示审查员姓名列表
  - 默认提示："请选择审查员"

**文件上传区域**：
- 标题："上传文件 *"（红色星号表示必填）
- 上传区域（虚线边框，可拖拽）：
  - 中间显示："点击上传 或 拖拽文件到此处"
  - 提示文字："仅支持PDF格式（.pdf），单个文件最大200MB"
  - 说明："系统支持文件秒传功能，重复文件将自动跳过上传"
  - "选择文件"按钮（居中）

- 已上传文件列表（上传后显示，表格形式）：
  - 列表标题："已上传文件（X个）"
  - 表格列：
    - 文件类型图标（PDF图标）
    - 文件名
    - 文件大小（如：2.5 MB）
    - 上传状态（计算MD5中/上传中/已完成/秒传成功）
    - 操作列：
      - "预览"按钮
      - "删除"按钮（红色，提交前可删除）

**底部操作按钮区域**（固定在页面底部或表单下方）：
- 左侧："取消"按钮（次要按钮，灰色，点击返回任务列表）
- 右侧："提交审查"按钮（主按钮，绿色或蓝色，大号突出显示）

**创建审查任务流程**：

1. 用户填写任务名称（必填）
2. 用户填写提交信息（可选，说明文件内容、需要审查的要点等）
3. 用户选择审查员（必选，下拉单选）
4. 用户上传文件（可多个）：
   - 支持拖拽上传、点击上传
   - 仅支持PDF格式（.pdf），后续版本可扩展支持图片
   - 单个文件最大200MB
   - 可上传多个文件
   - 上传过程：
     - ① 前端计算文件MD5（使用Web Worker后台计算，显示"计算文件指纹"进度）
     - ② 检查文件是否已存在（MD5去重，实现秒传）
     - ③ 如已存在则秒传（显示"秒传成功"），否则上传到MinIO
5. 系统验证：
   - 任务名称不能为空
   - 必须选择审查员
   - 至少上传1个文件
   - 文件类型验证：不支持的类型提示"不支持该文件类型，仅支持PDF格式"
   - 文件大小验证：超过限制提示"文件过大，单个文件最大200MB"
   - 存储配额验证：超过限制提示"存储空间不足，请联系管理员"
   - 文件名唯一性：同一版本下不允许重复文件名
6. 用户点击"提交审查"按钮
7. 系统执行：
   - 生成审查任务唯一ID
   - 创建审查版本v1
   - 保存任务信息到数据库（任务名称、提交信息、审查员、文件列表、版本号v1）
   - 审查任务状态设置为：审查中
   - 记录操作日志
8. 跳转到任务详情页面，提示"审查任务创建成功"

**上传文件列表展示**：

上传区域显示已上传的文件列表：
- 文件名
- 文件大小
- 文件类型图标
- 操作：预览、删除（提交前可删除）

### 3.3 审查员任务列表

审查员登录后，如果角色是"审查员"，在左侧菜单点击"审查任务"进入此页面。如果用户同时是普通用户和审查员，需先在头像下拉菜单切换到"审查员"角色。

**页面布局**：

**页面顶部区域**：
- 页面标题："待审查任务"（左上角）
- 工具栏：
  - 右侧依次排列：
    - 状态筛选下拉框（选项：全部/待审查/已通过/已打回，默认"全部"）
    - 任务名称或发起人搜索框（带搜索图标）
    - "搜索"按钮

**列表区域**（表格形式）：
- 表格列：
  - 任务名称（可点击，链接到任务详情）
  - 发起人（显示姓名）
  - 文件数量（如：3个文件）
  - 创建时间（格式：YYYY-MM-DD HH:mm）
  - 当前版本（如：v1、v2、v3）
  - 任务状态（标签形式，不同颜色：待审查-黄色、已通过-绿色、已打回-红色）
  - 操作列（每行末尾）：
    - "开始审查"按钮（仅状态为"待审查"时显示，主按钮）
    - "查看详情"按钮（链接按钮）
    - "查看历史"按钮（仅当版本号>v1时显示）

**底部分页器**：
- 显示总数、当前页/总页数
- 上一页、下一页、跳转页码

---

**任务详情页面布局**：

点击"查看详情"或任务名称进入任务详情页面。

**页面顶部**：
- 返回按钮（左上角，"← 返回列表"）
- 页面标题："审查任务详情"

**详情展示区域**（卡片式布局）：
- **基本信息卡片**：
  - 任务名称（大标题）
  - 发起人：XXX
  - 当前版本：v1
  - 任务状态：待审查（标签，带颜色）
  - 创建时间：YYYY-MM-DD HH:mm

- **提交信息卡片**（如用户有填写）：
  - 标题："提交说明"
  - 内容：用户填写的文字（多行显示）

- **文件列表卡片**：
  - 标题："审查文件"
  - 文件列表（每个文件一行）：
    - 文件类型图标（PDF/图片）
    - 文件名
    - 文件大小
    - 操作按钮："预览"、"下载"

- **审查信息卡片**（如已审查过且有填写）：
  - 标题："我的审查意见"
  - 审查时间：YYYY-MM-DD HH:mm
  - 审查结果：已通过 / 已打回（标签，带颜色）
  - 内容：自己填写的审查意见文字（多行显示）

**底部操作按钮**：
- 状态为"待审查"：显示"开始审查"按钮（主按钮，绿色或蓝色）
- 状态为"已通过"或"已打回"：无操作按钮（已审查完成）

---

**历史版本页面布局**：

点击列表中的"查看历史"按钮进入历史版本页面。

布局与"3.1用户审查任务列表 - 历史版本页面"相同，区别是：
- 页面顶部显示：返回按钮 + "历史版本 - [任务名称]"
- 显示发起人而非审查员

---

**历史版本详情页面布局**：

点击某个历史版本的"查看详情"按钮进入。

布局与"任务详情页面"相同，区别是：
- 页面标题："历史版本详情 - v1"
- 显示该版本的提交信息、文件列表、自己填写的审查意见
- 文件只能预览和下载
- 无操作按钮（历史版本只读）

### 3.4 审查员审查

审查员在任务列表或任务详情页面点击"开始审查"按钮，进入审查页面。

**页面布局**（左右分栏，全屏显示）：

**页面顶部**（横跨左右两栏）：
- 返回按钮（左上角，"← 返回列表"）
- 任务名称（居中，大标题）
- 发起人 + 当前版本（右上角，如"张三 提交 | v2"）

---

**左侧：文件预览区**（占70%宽度，浅灰背景）：

**预览工具栏**（顶部固定）：
- 文件标签页（如有多个文件）：
  - 标签1："文件名1.pdf"
  - 标签2："图片.jpg"
  - （点击切换预览）
- 预览控制按钮（右侧）：
  - 缩小按钮（-）
  - 缩放比例显示（如：100%）
  - 放大按钮（+）
  - 旋转按钮（↻）
  - 全屏按钮（⛶）

**预览内容区**（占满剩余空间）：
- PDF预览：使用PDF.js渲染，支持翻页、滚动
- 图片预览：居中显示，支持鼠标滚轮缩放

---

**右侧：操作区**（占30%宽度，白色背景）：

**任务信息区域**：
- **提交说明卡片**（如用户有填写）：
  - 标题："提交说明"
  - 内容：用户填写的文字（灰色背景，多行显示，只读）

- **文件列表卡片**：
  - 标题："审查文件（X个）"
  - 文件列表（每个文件一行，可点击切换预览）：
    - 文件类型图标
    - 文件名（截断显示）
    - 点击切换到对应文件预览

**审查操作区域**（固定在右侧底部）：
- **审查意见输入框**：
  - 标签："审查意见"（可选）
  - 多行文本框（高度约150px）
  - 提示文字："可填写审查意见、问题说明、修改建议等"

- **操作按钮**（两个按钮并排）：
  - "打回"按钮（左侧，红色，次要按钮）
  - "通过"按钮（右侧，绿色，主按钮，大号突出显示）

**审查操作流程**：

1. 审查员查看文件（可切换多个文件）
2. 审查员查看用户的提交信息（如有）
3. 审查员做出决定：

**情况A：审查通过**
1. 审查员可选择填写审查意见（如"文件符合要求"等正面意见）
2. 审查员点击"通过"按钮
3. 系统弹窗确认："确认通过此审查任务？"
4. 审查员确认
5. 系统执行：
   - 任务状态更新为：已通过
   - 保存审查意见（审查员、审查时间、结果：通过、审查意见内容如有）
   - 记录操作日志
6. 提示"审查通过"，返回任务列表

**情况B：审查打回**
1. 审查员可选择填写审查意见（如说明问题、修改建议等）
2. 审查员点击"打回"按钮
3. 系统弹窗确认："确认打回此审查任务？"
4. 审查员确认
5. 系统执行：
   - 任务状态更新为：已打回
   - 保存审查意见（审查员、审查时间、结果：打回、审查意见内容如有）
   - 记录操作日志
6. 提示"已打回，等待用户修改"，返回任务列表

### 3.5 用户再次提交

用户在任务详情页面看到"已打回"状态后，点击"再次提交"按钮，进入再次提交页面。

**页面布局**：

**页面顶部**：
- 返回按钮（左上角，"← 返回任务详情"）
- 页面标题："再次提交审查"

**表单区域**（居中，最大宽度800px）：

**审查意见展示区域**（只读卡片，灰色背景）：
- 标题："审查意见"
- 审查员姓名
- 审查时间：YYYY-MM-DD HH:mm
- 审查意见内容：审查员填写的文字（多行显示，如有）

**文件管理区域**：
- 标题："修改文件"
- 说明提示："提交后将创建新版本（v2、v3...），以下文件列表已自动从上一版本复制，您可以修改"
- 当前文件列表（显示从上一版本复制的文件，表格形式）：
  - 表格列：
    - 文件类型图标（PDF图标）
    - 文件名
    - 文件大小（如：2.5 MB）
    - 操作列：
      - "预览"按钮
      - "更换"按钮（点击选择新文件替换当前文件）
      - "删除"按钮（红色）
- "添加文件"按钮（可追加新文件，位于文件列表下方）
- 提示文字："仅支持PDF格式（.pdf），单个文件最大200MB"

**提交说明区域**：
- 标签："提交说明"（可选）
- 输入框：多行文本框（高度约100px，宽度100%）
- 提示文字："可说明根据审查意见做了哪些修改"

**底部操作按钮区域**（固定在页面底部或表单下方）：
- 左侧："取消"按钮（次要按钮，灰色，点击返回任务详情）
- 右侧："提交审查"按钮（主按钮，绿色或蓝色，大号突出显示）

**再次提交流程**：

1. 用户查看审查员的审查意见（如有）
2. 用户点击"提交新版本"按钮
3. 系统执行：
   - 创建新版本记录（版本号递增：v2、v3...）
   - **通过RabbitMQ异步复制文件**（后台任务，不阻塞用户）：
     - 查询上一版本的所有文件
     - 批量创建新版本文件记录（指向相同的MinIO对象，实现秒速复制）
     - 不实际复制MinIO文件（MD5去重，节省存储空间）
   - 前端轮询检查文件复制状态（每2秒查询一次，最多30次）
   - 显示"正在复制文件..."进度提示
4. 文件复制完成后，用户可以修改文件列表：
   - 更换文件：点击"更换"，选择新文件替换当前文件（支持MD5秒传）
   - 删除文件：点击"删除"，删除不需要的文件
   - 添加文件：点击"添加文件"，上传新文件（支持MD5秒传）
5. 用户填写提交信息（可选，说明根据审查意见做了哪些修改）
6. 用户点击"提交审查"按钮
7. 系统验证：
   - 至少保留1个文件：提示"至少需要1个文件"
   - 文件类型验证：不支持的类型提示"不支持该文件类型，仅支持PDF格式"
   - 文件大小验证：超过限制提示"文件过大，单个文件最大200MB"
   - 存储配额验证：超过限制提示"存储空间不足，请联系管理员"
   - 文件名唯一性：同一版本下不允许重复文件名
8. 系统执行：
   - 更新版本状态和提交信息
   - 审查任务状态更新为：用户看到"审查中"，审查员看到"待审查"
   - 审查员保持不变（沿用原审查员）
   - 记录操作日志
9. 提示"提交成功，等待审查"，返回任务详情页面

## 4. 非功能需求

### 4.1 性能要求

#### 4.1.1 响应时间
- 页面加载时间：首屏加载 < 2秒
- 列表查询响应：< 1秒
- 文件上传响应：单个文件上传进度实时反馈，200MB文件上传 < 30秒（取决于网络带宽）
- 文件预览加载：PDF首页预览 < 3秒

#### 4.1.2 并发性能
- 支持单租户100个并发用户同时在线操作
- 支持平台级1000个并发用户同时访问
- 文件上传：支持单租户10个并发上传
- 数据库连接池：合理配置，支持高并发查询

#### 4.1.3 数据处理能力
- 单个审查任务支持最多20个文件
- 单个文件最大200MB
- 单个租户文件总存储：按配额限制（默认100GB，可调整）
- 审查任务列表分页：每页20条

### 4.2 可靠性要求

#### 4.2.1 系统可用性
- 系统可用性：≥ 99.5%（年停机时间 < 44小时）
- 计划内维护窗口：每月1次，凌晨2:00-4:00，提前3天通知

#### 4.2.2 数据可靠性
- 数据备份：每日全量备份，保留最近7天
- 数据库事务：使用事务保证数据一致性
- 文件存储：MinIO采用纠删码模式，保证数据冗余

#### 4.2.3 故障恢复
- 故障检测时间：< 5分钟
- 系统恢复时间目标（RTO）：< 4小时
- 数据恢复点目标（RPO）：< 24小时

### 4.3 安全性要求

#### 4.3.1 身份认证
- 密码策略：至少6位（可包含字母、数字、特殊字符）
- 密码加密：使用BCrypt算法加密存储
- 登录失败限制：连续失败5次锁定30分钟（使用Redis记录失败次数）
- 会话管理：JWT Token，有效期24小时

#### 4.3.2 权限控制
- 基于角色的访问控制（RBAC）
- 数据隔离：租户间数据完全隔离，通过tenant_id强制隔离
- 操作权限：细粒度权限控制，用户只能操作自己权限范围内的数据

#### 4.3.3 数据安全
- 数据传输：使用HTTPS加密传输
- 敏感数据：密码、Token等敏感信息加密存储
- SQL注入防护：使用参数化查询，防止SQL注入
- XSS防护：前端输入验证和输出转义
- 文件安全：文件类型白名单验证（仅允许.pdf格式），单文件最大200MB

#### 4.3.4 审计日志
- 操作日志：记录关键操作（登录、创建用户、审查操作等）
- 日志内容：操作人、操作时间、操作类型、操作对象、操作结果
- 日志保留：至少保留6个月

### 4.4 易用性要求

#### 4.4.1 界面设计
- 界面简洁清晰，布局合理，无冗余信息
- 操作流程符合用户习惯，减少学习成本
- 关键操作提供确认提示，防止误操作

#### 4.4.2 兼容性
- 浏览器支持：Chrome（最近2个版本）、Edge（最近2个版本）、Firefox（最近2个版本）
- 屏幕分辨率：最低支持1366x768
- 移动端：暂不支持移动端访问

#### 4.4.3 提示与反馈
- 操作成功/失败提示清晰明确
- 表单验证：实时提示错误信息
- 加载过程：显示加载动画或进度条

### 4.5 可维护性要求

#### 4.5.1 代码质量
- 代码规范：遵循统一的编码规范
- 代码注释：关键逻辑添加注释说明
- 模块化设计：功能模块解耦，便于维护

#### 4.5.2 日志管理
- 系统日志：记录系统运行状态、错误信息
- 日志级别：DEBUG、INFO、WARN、ERROR
- 日志输出：支持控制台输出和文件输出

#### 4.5.3 监控告警
- 系统监控：CPU、内存、磁盘、网络等资源监控
- 应用监控：接口响应时间、错误率监控
- 告警机制：异常情况及时告警通知

### 4.6 可扩展性要求

#### 4.6.1 架构扩展
- 采用前后端分离架构，便于独立扩展
- 数据库支持读写分离、分库分表扩展
- 文件存储支持横向扩展（MinIO集群）

#### 4.6.2 功能扩展
- 预留接口扩展能力，便于后续功能迭代
- 支持多种文件类型扩展（当前仅PDF和图片）
- 支持审查流程自定义扩展

### 4.7 技术栈要求

#### 4.7.1 后端技术栈
- **开发语言**：Java 8+
- **核心框架**：Spring Boot 2.x
- **Web框架**：Spring MVC（构建RESTful API）
- **持久层**：MyBatis/MyBatis-Plus（SQL优化、索引优化）
- **安全框架**：Spring Security + JWT
- **项目构建**：Maven

#### 4.7.2 前端技术栈
- **开发框架**：Vue 3 + Element Plus 或 React + Ant Design
- **PDF预览**：PDF.js
- **HTTP客户端**：Axios
- **构建工具**：Vite 或 Webpack

#### 4.7.3 数据库与存储
- **关系数据库**：MySQL 8.0+
- **对象存储**：MinIO（兼容S3协议）
- **连接池**：Druid（支持SQL监控、慢SQL分析）

#### 4.7.4 中间件
- **配置中心**：Nacos（服务配置管理）
- **消息队列**：RabbitMQ 或 RocketMQ（异步任务处理，如文件上传后的通知）
- **日志框架**：SLF4J + Logback
- **文档工具**：Swagger/Knife4j（API文档）

#### 4.7.5 部署环境
- **容器化**：Docker + Docker Compose
- **操作系统**：Linux（CentOS 7+、Ubuntu 18.04+）
- **反向代理**：Nginx（前端静态资源、后端API代理）

#### 4.7.6 开发工具
- **IDE**：IDEA
- **版本控制**：Git
- **API测试**：Postman 或 Apifox
